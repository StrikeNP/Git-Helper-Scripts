=========================================
USERS GUIDE FOR WRF-LES (module_wrfles.F)
=========================================

Takanobu Yamaguchi, CIRES CU & NOAA ESRL: tak.yamaguchi@noaa.gov

1. Purpose
The /path2wrf/frame/module_wrfles.F is developed to transform WRF as more user friendly LES model.

2. Preprocess and compile
To use this module, add -DWRFLES in ARCHFLAGS in configure.wrf.
Do not compile with OpenMP.

3. Create your case
(1) Copy one of the prepared case directories with new name, e.g., DYCOMS_RF01.
(2) Edit prm, lsf, sfc
   (a) prm
       LESPRM has to be set. STAT has to be set for statistical output. You do not need to edit ./stat/prm for statistical output.

       (i) LESPRM
       1) GENERAL PARAMETER LIST
       dospecifysst: If TRUE, then apply prescribed SST specified in sfc file.
                     If TRUE, also set sf_sfclay_physics = 1, sf_surface_physics = 0 in namelist.input.
       docompsfcflx: If FALSE, then apply prescribed surface sensible and latent heat flux specified in sfc file.
                     If FALSE, also set sf_sfclay_physics = 1, sf_surface_physics = 0 in namelist.input.
       docompsfcust: If FALSE, then apply prescribed friction velocity specified in sfc file.
                     If FALSE, also set sf_sfclay_physics = 1, sf_surface_physics = 0 in namelist.input.
       dosfcspecial: If TRUE, then surface friction velocity and fluxes are computed with the code specified with sfcspecial_type.
                     If TRUE, also set sf_sfclay_physics = 1, sf_surface_physics = 0 in namelist.input.
       doupdategwnd: If TRUE, update geostrophic wind, i.e., update u_base and v_base in WRF code.
                     The geostrophic wind has to be specified in lsf file. Useful, for example, for the Coriolis term calculation.
                     IF FALSE, WRF uses the initial wind profile as geostrophic wind.
       dosubsidence: If TRUE, apply large-scale subsidence for u, v, theta, moist, and scalar with specified subsidence, wlsf, in lsf file.
       doadvforcing: If TRUE, apply advective forcing for theta and qv with tendency specified in lsf file
       doradforcing: If TRUE, apply radiative forcing specified in lsf file. Set ra_lw_physics=0 and ra_sw_physics=0 in namelist.input
                     To force zero radiative forcing, set doradforcing=.FALSE., and set ra_lw_physics=0 and ra_sw_physics=0 in namelist.input
       donudging_uv: IF TRUE, apply nudging for mean u and v toward specified wind profiles in lsf file. tau_ndg has to be set.
       donudging_tq: IF TRUE, apply nudging for mean theta and qv toward specified profiles in lsf file. tau_ndg has to be set.
       donudging_tp: IF TRUE, apply nudging for mean theta.
       donudging_qv: IF TRUE, apply nudging for mean qv.
       donudging_qt: IF TRUE, apply nudging for mean qt in stead of qv toward a specified profile in lsf. donudging_tq has to be TRUE.
       doupperbound: IF TRUE, the vertical gradient for theta and qv of the two highest levels are kept same,
                     i.e., (q(ktop)-q(ktop-1)) / (z(ktop)-z(ktop-1)) = (q(ktop-1)-q(ktop-2)) / (z(ktop-1)-z(ktop-2))
       perturb_type: Initial perturbation type. Default is 0. See/add code in the subroutine wrfles_setperturb for detail.
       sfcspecial_tye: Surface calculation type with a special code. Default is 0, which outputs ustar=shflux=lhflux=0. 1 for RICO case.
                       Special code for new cases can be added in the subroutine wrfles_sfcforcing_special.
       surface_type: 1 for land, 2 for ocean
       coriolis: Coriolis parameter (s-1)
       latitude, longitude: latitude and longitude
       tau_ndg: nudging time scale in seconds
       ug, vg: Domain translation velocities. Currently unavailable.
       
       2) PARAMETER LIST FOR FEINGOLD MICROPHYSICS SCHEME
       nccn_feingold2m: CCN number concentration (#/mg)
       dg_ccn_feingold2m: Mean of CCN size distribution (cm)
       sg_ccn_feingold2m: Sigma of CCN size distrituion 
       sg_cloud_feingold2m: Sigma of cloud distribution
       sg_rain_feingold2m: Sigma of rain distribution
       drzst_feingold2m: # of seconds to initialte drizzle
       drzflg_feingold2m: Integer flag for sedimentation scheme, 0-no sedimenation, 1-bin, 2-bulk
       colflg_feingold2m: IF TRUE, collision & coalescence are processed
       srcccn_add_feingold2m: IF TRUE, add CCN source
       srcccn_startstep_feingold2m: Start time step for soruce of CCN
       srcccn_starttime_feingold2m: Start actual time (second)
       srcccn_feingold2m: Source of CCN (#/mg/hour)
       srcccn_qvmin_feingold2m: CCN source is applied more than this value (g/kg)

       (ii) STAT
       Follow README.stat in ./stat/. Do not forget to add -DWRFSTAT in ARCHFLAGS in configure.wrf.
       Output name will be CaseName_stat_file_name.stat.

   (b) lsf
       The lsf file contains:
          - large scale profile of theta and qv for nudging,
          - geostrophic wind for nudging and/or updating WRF's geostrophic wind,
          - large scale subsidence,
          - advective tendency for theta and qv, and
          - radiative forcing.
       The lsf file has to contain at least two different times.
       The each profile is linearly-interpolated between two time levels to obtain the profile at the current time.
       The value will be vertically interpolated with a monotonic cubic interpolation, which requires at least four levels.
       The monotonic cubic interpolation gives smoother profile than the linear interpolation.
       If the profile is a strictly linear function, using simulation vertical levels or finer well matches the interpolated profile to the linear function. 
       Use same sounding for the two soundings for the time-independent forcing.
       Use the initial sounding for u, v, theta, qv (or qt) if the fields should be nudged to the initial sounding.
       If the initial sounding for t and q are actually thetal and qt, then they might have to be converted to theta and qv depending on flags. 
       Radiative forcing, rlsf, is in absolute temperature, not theta.

       z(m) tlsf(K) qlsf(g/kg) ulsf(m/s) vlsf(m/s) wlsf(m/s) dtlsf(K/s) dqlsf(kg/kg/s) rlsf(K/s) <--- header
        301  nzlsf <-- number of vertical level
          0.  day <--- day, which is zero at the first time step
          0.0  289.00  9.0  7.0  -5.5  0.0  0.0  0.0  0.0 <--- input values of, z, tlsf, qlsf, ..., rlsf
        ...
       1500.0  306.21  1.5  7.0  -5.5  0.0  0.0  0.0  0.0 <-- highest forcing level, which has to be equal or above domain top
         10.  day
          0.0  289.00  9.0  7.0  -5.5  0.0  0.0  0.0  0.0
        ...
       1500.0  306.21  1.5  7.0  -5.5  0.0  0.0  0.0  0.0

   (c) sfc
       Like lsf file, at least two time levels are required.
       Strictly speaking, shflux is computed with theta

       day sst(K) shflux(W/m2) lhflux(W/m2) ustar(m/s)
         0.  292.5  15.0  115.0  0.25
        10.  292.5  15.0  115.0  0.25

4. Edit CaseName
Edit the CaseName file. It should contain only the name of the case directory, e.g., DYCOMS_RF01

5. Edit namelist.input
Set e_we and e_sn to be odd number.

6. Run.
